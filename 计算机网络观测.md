---
title: 计算机网络观测
date: 2016-10-10 08:39:17
tags:
---
[toc]

---

# Summary
本文利用104.128.92.224和119.29.198.230进行对比，对计算机网络原理进行观测。他们是独立的Server（VPS），其中，104.128.92.224位于Los Angeles，119.29.198.230位于广州，通过对比确认GFW的特殊价值。本文主要参考http://drops.wooyun.org/papers/10177 ，并对探索过程中遇到的问题做简单记录，遇到问题包括**计算机网络**、**计算机操作系统**、**编译原理**的部分知识。

[#reference-104.128.92.224的IP地址](http://ip.cn/index.php?ip=104.128.92.224)
[#reference-119.29.198.230的IP地址](http://ip.cn/index.php?ip=119.29.198.230)
 [#reference-【转】翻墙路由器的原理与实现](http://noragithub.github.io/2016/10/06/%E3%80%90%E8%BD%AC%E3%80%91%E7%BF%BB%E5%A2%99%E8%B7%AF%E7%94%B1%E5%99%A8%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/)
 #reference- 操作系统的差异
 [#reference-netfilterqueue文档](https://pypi.python.org/pypi/NetfilterQueue)

# 工具
## NetfilterQueue

我们主要利用[NetfilterQueue](https://github.com/kti/python-netfilterqueue)进行计算机网络的观测，这是Libnetfilter\_queue的python实现，Libnetfilter\_queue是[Netfilter project](http://netfilter.org/projects/libnetfilter_queue/)的一部分。
Linux下，NetfilterQueue允许用户访问符合iptables规则的IP包。iptables也是Netfilter project的一部分，理解成一张用于保存IP包转发规则的table就好，主要用于防火墙。利用这套规则，计算机可以接受、丢弃，改变（转发）和标记IP包。

### 安装
NetfilterQueue有依赖，不细心的童鞋会走弯路（例如我T_T）

>sudo apt-get install build-essential python-dev libnetfilter-queue-dev # 系统依赖
>sudo pip install NetfilterQueue # NetfilterQueue安装

#### 安装过程中可能遇到的问题

未安装gcc，无法编译。显示：

```
unable to execute 'gcc': No such file or directory
error: Setup script exited with error: command 'gcc' failed with exit status 1
```

安装gcc
>  \$ sudo apt-get install gcc

## pip
pip是python下包管理工具。主要用于安装和管理python包，和easy\_install类似。
###  Install& Update& Upgrade
好像不正确的安装的package有问题。

>  \$ sudo apt-get python-pip

[#reference-How to install pip on Ubuntu](http://www.saltycrane.com/blog/2010/02/how-install-pip-ubuntu/)
[#reference-Doc\_installing](https://pip.pypa.io/en/stable/installing/)
[#reference-easy\_install进行模块/包管理](http://www.cnblogs.com/PandaBamboo/p/3180568.html)
[#reference-How to install software or upgrade from an old unsupported release](http://askubuntu.com/questions/91815/how-to-install-software-or-upgrade-from-an-old-unsupported-release)

## dpkt
>  \$ sudo pip install dpkt

## Bind-dig
dig 命令全称Domain Information Groper，系统自带，观测过程中需要用到的主要命令。
[#reference-Internet System Consortium-BIND](https://www.isc.org/downloads/bind/)
[#reference-How do I install dig](http://askubuntu.com/questions/25098/how-do-i-install-dig)
[#reference-使用 Ubuntu 安裝 Bind9: Domain Name Service (DNS)
](http://www.nowtaxes.com.tw/node/1114)

# 计算机网络观测
## DNS劫持观测
>$ dig @8.8.8.8 twitter.com
>
>; <<>> DiG 9.8.3-P1 <<>> @8.8.8.8 twitter.com
>; (1 server found)
>;; global options: +cmd
>;; Got answer:
>;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 45740
>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0
>
>;; QUESTION SECTION:
>;twitter.com.			IN	A
>
>;; ANSWER SECTION:
>twitter.com.		60	IN	A	243.185.187.39
>
>;; Query time: 112 msec
>;; SERVER: 8.8.8.8#53(8.8.8.8)
>;; WHEN: Sat Oct 15 13:07:17 2016
>;; MSG SIZE  rcvd: 45

![返回错误IP](http://of2r0f294.bkt.clouddn.com/20161015-%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AFIP_ID)

显然，返回的IP地址错误。

## 安装apt-get install ...
http://askubuntu.com/questions/91815/how-to-install-software-or-upgrade-from-an-old-unsupported-release

sudo 权限下完成

(#4。 有依赖)
https://pypi.python.org/pypi/NetfilterQueue
> \$ sudo apt-get install build-essential python-dev libnetfilter-queue-dev

&&
sudo apt-get install python-pip
>sudo pip install NetfilterQueue
>sudo pip install dpkt

#开始观测

>mkdir computer_network_observe
>cd computer\_network\_observe

# 操作系统&编译原理
编译错误
>ImportError: /usr/local/lib/python2.6/dist-packages/netfilterqueue.so: undefined symbol: nfq_set_verdict2

nm命令查看变量定义
http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/nm.html

ldd查看库依赖
http://man.linuxde.net/ldd
http://tieba.baidu.com/p/315634750
http://blog.csdn.net/tenfyguo/article/details/5605120

为ubuntu用户获取root权限失败
http://askubuntu.com/questions/302358/permission-denied-error
https://www.google.com.hk/search?newwindow=1&c2coff=1&safe=strict&hl=zh-CN&q=+visudo+permission+de&oq=+visudo+permission+de&gs_l=serp.3..0j0i30k1l3j0i8i30k1l3j0i5i30k1l2.290009.295367.0.296570.17.13.0.0.0.0.558.2178.2-3j1j1j1.6.0....0...1c.1.64.serp..11.6.2174...0i13k1j0i7i30k1j0i7i10i30k1j35i39k1.3Yf3P28PMq0
http://blog.csdn.net/stormbjm/article/details/9086163




[summary](https://github.com/kti/python-netfilterqueue/issues/16)
...
放弃了。。。还是明天用canopy到深圳机器看看把。


以上无用功

升级内核libnetfilter版本
